
<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>ScanCarnet ‚Äì Int√©gration d√©mo (Add‚Äëons)</title>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif; margin: 16px; }
    .session { border: 1px solid #ddd; border-radius: 10px; padding: 12px; margin: 8px 0; }
    .session h3 { margin: 0 0 8px; }
    .toolbar button { padding: 8px 12px; border-radius: 10px; border: 1px solid #ddd; background: #f8f8f8; }
    .toolbar label { padding: 8px 12px; border-radius: 10px; border: 1px solid #ddd; background: #f8f8f8; }
    .muted { color: #666; font-size: 13px; }
  </style>

  <!-- D√©pendances -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

  <!-- Add‚Äëons -->
  <script src="./scancarnet-tools.js"></script>
</head>
<body>
  <h1>Carnet ‚Äì D√©mo d‚Äôint√©gration</h1>
  <p class="muted">Cette page ne remplace rien dans votre app. Elle montre juste comment brancher les boutons.</p>

  <div class="toolbar" style="display:flex; gap:.5rem; flex-wrap:wrap; margin:.5rem 0;">
    <button id="btn_pdf">üìÑ PDF</button>
    <button id="btn_share">üì§ Partager / Envoyer</button>
    <button id="btn_save">üíæ Enregistrer</button>
    <button id="btn_export">‚¨áÔ∏è Export JSON</button>
    <label style="display:inline-flex;align-items:center;gap:.5rem;cursor:pointer;">
      ‚¨ÜÔ∏è Import JSON
      <input type="file" id="file_import" accept="application/json" style="display:none;">
    </label>
  </div>

  <!-- Tout le contenu √† inclure dans le PDF -->
  <div id="carnet-root">
    <header>
      <h2>Athl√®te: Jean Dupont</h2>
      <div class="muted">Objectif: 800m ‚Äì S1 √† S6</div>
    </header>

    <div id="sessions"></div>
  </div>

  <script>
    // D√©mo de donn√©es (√† remplacer par les v√¥tres)
    window.SCANCARNET_DATA = {
      athlete: { nom: "Dupont", prenom: "Jean" },
      seances: Array.from({ length: 18 }).map((_, i) => ({
        titre: "S√©ance " + (i + 1),
        contenu: "Contenu d√©taill√© de la s√©ance " + (i + 1) + " : √©chauffement, √©ducatifs, corps de s√©ance, retour au calme."
      }))
    };

    function renderCarnet() {
      const root = document.getElementById("sessions");
      root.innerHTML = "";
      (window.SCANCARNET_DATA.seances || []).forEach((s, idx) => {
        const div = document.createElement("div");
        div.className = "session";
        div.innerHTML = "<h3>" + s.titre + "</h3><p>" + s.contenu + "</p>";
        root.appendChild(div);
        // Ajoute des sauts de page volontaires pour d√©mo :
        if ((idx + 1) % 6 === 0) {
          const br = document.createElement("div");
          br.className = "page-break";
          root.appendChild(br);
        }
      });
    }
    window.renderCarnet = renderCarnet;
    renderCarnet();

    // Auto‚Äëchargement au d√©marrage
    (function() {
      var boot = window.ScanCarnetTools.loadDataLocally();
      if (boot) {
        window.SCANCARNET_DATA = boot;
        renderCarnet();
      }
    })();

    // Brancher les boutons
    document.getElementById('btn_pdf')?.addEventListener('click', () => {
      window.ScanCarnetTools.generateFullPDF({ rootSelector: '#carnet-root', title: 'Carnet d‚Äôentra√Ænement' })
        .then(pdf => pdf.save('Carnet.pdf'));
    });

    document.getElementById('btn_share')?.addEventListener('click', () => {
      window.ScanCarnetTools.sharePDF({ rootSelector: '#carnet-root', title: 'Carnet d‚Äôentra√Ænement' });
    });

    document.getElementById('btn_save')?.addEventListener('click', () => {
      const ok = window.ScanCarnetTools.saveDataLocally(window.SCANCARNET_DATA);
      alert(ok ? 'Donn√©es enregistr√©es sur cet appareil.' : '√âchec de l‚Äôenregistrement.');
    });

    document.getElementById('btn_export')?.addEventListener('click', () => {
      window.ScanCarnetTools.exportDataJSON();
    });

    document.getElementById('file_import')?.addEventListener('change', async (e) => {
      const file = e.target.files && e.target.files[0];
      if (!file) return;
      try {
        const obj = await window.ScanCarnetTools.importDataJSONFromFile(file);
        window.SCANCARNET_DATA = obj || {};
        renderCarnet();
        alert('Donn√©es import√©es.');
      } catch (err) {
        console.error(err);
        alert('Import impossible (fichier invalide).');
      } finally {
        e.target.value = '';
      }
    });
  </script>
</body>
</html>
